<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Iniciar sesión</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
    <div class="body_vid" style="z-index: 0; height: 100%; position: fixed;"></div>
    <div class="login-container" style="z-index: 10; position: relative;">
        <a href="index.html" class="home-icon" aria-label="Ir al inicio" >
            <svg height="100" width="100" xmlns="http://www.w3.org/2000/svg"><circle r="25" cx="50" cy="50" fill="white" /></svg>
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#129be5" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" style="transform: translateX(-69px);"><path d="M3 12L12 3l9 9"/><path d="M9 21V9h6v12"/></svg>
        </a>
        <h2>Iniciar sesión</h2>
        <input id="email" type="email" placeholder="Correo electrónico" autocomplete="username" required>
        <input id="password" type="password" placeholder="Contraseña" autocomplete="current-password" required>
        <a href="recuperar.html" class="forgot-link">¿SE TE OLVIDO TU CONTRASEÑA?</a>
        <button class="ingresa-btn" onclick="login_user()">INGRESAR</button>
    </div>
    
</body>
</html>

<script src="js/api.js"></script>
<script src="js/behaviour.js"></script>
<script>

        async function login_user(){
            usuario = document.getElementById("email").value;
            password = document.getElementById("password").value;
            res = await login_usuario(usuario, password);
            if(res.length > 0){
                // Guardar los datos del usuario en localStorage
                const userData = res[0]; // Tomar el primer usuario de la respuesta
                localStorage.setItem('userId', userData.id || userData.usuario_id || '');
                localStorage.setItem('userEmail', userData.email || usuario);
                localStorage.setItem('userName', userData.nombre || '');
                localStorage.setItem('userPhone', userData.fono || '');
                localStorage.setItem('userRut', userData.rut || '');
                
                abre_pag('home.html');
            } else {
                alert("Usuario o contraseña incorrectos");
            }
        }

</script>