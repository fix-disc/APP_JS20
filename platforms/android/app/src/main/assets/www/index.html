<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
        <meta name="color-scheme" content="light dark">
        <link rel="stylesheet" href="css/index.css">
        <title>Justicia-Sociapp</title>
        <link rel="icon" type="image/png" href="img/JS.png">
    </head>
    <body>
        <div class="body_vid"></div>
        <div id="logo-container">
            <img id="main-logo" src="img/JS.png" width="200px" alt="Logo">
            <div id="click-hint">CLICKEAME! :D</div>
        </div>
        <div id="welcome-modal" class="hidden">
            <div id="deviceready" class="welcome-content">
                <h2>¡Bienvenido a tu portal de reclamos y avisos!</h2>
                <p>Inicia sesión para continuar:</p>
                
                <div class="login-form">
                    <input id="email" type="email" placeholder="Correo electrónico" autocomplete="username" required>
                    <input id="password" type="password" placeholder="Contraseña" autocomplete="current-password" required>
                    <a href="recuperar.html" class="forgot-link">¿SE TE OLVIDO TU CONTRASEÑA?</a>
                    <button class="ingresa-btn" onclick="login_user()">INGRESAR</button>
                </div>
            </div>
            <button id="close-welcome" class="close-btn" aria-label="Cerrar">&times;</button>
        </div>
        <script src="cordova.js"></script>
        <script src="js/index.js"></script>
        <script src="js/api.js"></script>
        <script src="js/behaviour.js"></script>
    </body>
</html>  

<script>

var uuid = "";
var fabrica = "";
var modelo = "";
var platform = "";

async function valida_usuario(){
    try{
        alert(uuid);
        if(uuid == ""){uuid = "25"}
        res = await get_users(uuid);
        alert("RES: " + JSON.stringify(res))
        if (res.length == 0){
            abre_pag("error_uuid.html");
        }
    }catch(e){
        alert("ERROR: " + e)
    }
}

async function login_user(){
    usuario = document.getElementById("email").value;
    password = document.getElementById("password").value;
    
    if(!usuario || !password) {
        alert("Por favor, completa todos los campos");
        return;
    }
    
    try {
        res = await login_usuario(usuario, password);
        if(res.length > 0){
            // Guardar los datos del usuario en localStorage
            const userData = res[0]; // Tomar el primer usuario de la respuesta
            localStorage.setItem('userId', userData.id || userData.usuario_id || '');
            localStorage.setItem('userEmail', userData.email || usuario);
            localStorage.setItem('userName', userData.nombre || '');
            localStorage.setItem('userPhone', userData.fono || '');
            localStorage.setItem('userRut', userData.rut || '');
            
            abre_pag('home.html');
        } else {
            alert("Usuario o contraseña incorrectos");
        }
    } catch(e) {
        alert("Error al iniciar sesión: " + e);
    }
}

</script>